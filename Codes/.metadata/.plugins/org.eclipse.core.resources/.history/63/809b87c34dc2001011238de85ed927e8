/*
 * STM32_GPIO.c
 *
 *  Created on: Oct 20, 2025
 *      Author: ANAS
 */

#include <STM32_GPIO.h>



void pin_init(uint8_t pin , uint8_t mode)
{
	switch(mode)
	{
		case PIN_OUTPUT:
			gpiod_ptr->MODER &= ~(0X03<<(pin*2));		/// clearing the mode bits for the LED
			gpiod_ptr->MODER |= (0x01 << (pin*2));		/// setting the mode bits as output for the LED
			break;
		case PIN_INPUT:
			break;
		case PIN_ALTERNATE_FUNCTION:
			break;

		default:
			break;
	}

}


void pin_operation (uint8_t pin , uint8_t state)
{
	if(state == TOGGLE)
	{
		gpiod_ptr->ODR ^= (1<<pin);					/// toggling the LED
	}
	else if (state == ON)
	{
		gpiod_ptr->ODR |= (1<<pin);					/// Turn on the LED
	}
	else
	{
		gpiod_ptr->ODR &= ~(1<<pin);				/// Turn off the LED
	}
}

void set_alternate_function_portD(uint8_t pin, uint8_t device)
{
	switch(device)
	{
	case TIMER3:
		if(pin<=7)
		{
	        gpiod_ptr->AFRL &= ~(0x0F << (pin * 4));  // clear old AF
	        gpiod_ptr->AFRL |=  (0x02   << (pin * 4));  // set new AF
		}
		else if(pin<=15)
		{
			gpiod_ptr->AFRH &= ~(0x0F << ((pin - 8)*4));	/// clearing the AFRH bits for timer3 in portD
			gpiod_ptr->AFRH |= (0x02<<((pin - 8)*4));		/// setting for timer3
		}
		break;

	default:
		break;
	}
}

